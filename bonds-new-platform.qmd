---
title: "Bonds New Platform"
format: html
execute: 
  echo: false
---

```{r}
#| message: false
#| warning: false

library(tidyverse)
library(lubridate)
library(tidytext)
library(patchwork)

df2 <- read_csv("data/bonds-new-platform - trello.csv", show_col_types = FALSE)
```

```{r}
#| message: false

# Graph 10
# Pie chart could also be used
graph10 <- df2 |> 
  filter(!is.na(Status)) |> 
  count(Status) |> 
  ggplot(aes(x = reorder(Status, -n), y = n, fill = Status)) +
  geom_col(show.legend = FALSE) +
  labs(
    title = "Workload by Task Status",
    x = "Status",
    y = "Number of Tasks"
  ) +
  theme_minimal()

# Graph 11
# Pie chart could also be used
graph11 <- df2 |> 
  filter(!is.na(Priority)) |> 
  count(Priority) |> 
  ggplot(aes(x = reorder(Priority, -n), y = n, fill = Priority)) +
  geom_col(show.legend = FALSE) +
  labs(
    title = "Task Count by Priority Level",
    x = "Priority",
    y = "Number of Tasks"
  ) +
  theme_minimal()

# Graph 12
# Good
df_clean2 <- df2 |> 
  mutate(Date = as.Date(`Due Date...25`, format = "%Y-%m-%d"),
         Year = year(Date),
         Month = month(Date, label = TRUE, abbr = TRUE)) |> 
  filter(!is.na(Date))

monthly_card_counts2 <- df_clean2 |> 
  group_by(Year, Month) |> 
  summarise(CardCount = n()) |> 
  ungroup()

graph12 <- ggplot(monthly_card_counts2, aes(x = Month, y = CardCount, color = factor(Year), group = Year)) +
  geom_line(linewidth = 1.2) +
  geom_point() +
  labs(
    title = "Number of Cards per Month by Year",
    x = "Month",
    y = "Number of Cards",
    color = "Year"
  ) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1")

# Graph 13
# Too clumped together, should be separate lines or faceted for year
graph13 <- df2 |> 
  mutate(Date = as.Date(`Requested Date`)) |> 
  filter(!is.na(Date) & !is.na(`Effort`)) |> 
  group_by(Date = floor_date(Date, "week")) |> 
  summarise(Total_Hours = sum(`Effort`)) |> 
  ggplot(aes(x = Date, y = Total_Hours)) +
  geom_line(color = "blue") +
  labs(title = "Worked Hours Over Time", x = "Week", y = "Total Hours Worked") +
  theme_minimal()

# Graph 14
# Weird graph
graph14 <- df2 |> 
  filter(!is.na(Status) & !is.na(Labels)) |> 
  separate_rows(Labels, sep = ",\\s*") |> 
  count(Status, Labels) |> 
  ggplot(aes(x = Status, y = n, fill = Labels)) +
  geom_col(position = "stack") +
  labs(title = "Priority Breakdown by Status", x = "Status", y = "Task Count") +
  theme_minimal()

# Graph 15
# Could be pie chart, maybe different list name order
graph15 <- df2 |> 
  filter(!is.na(`List Name`)) |> 
  count(`List Name`) |> 
  ggplot(aes(x = reorder(`List Name`, n), y = n, fill = `List Name`)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(title = "Tasks by Trello List", x = "List Name", y = "Count") +
  theme_minimal()

# Graph 16
# Could be pie chart
top10words <- df2 |> 
  select(`Card Name`) |> 
  unnest_tokens(word, `Card Name`) |> 
  anti_join(stop_words) |> 
  count(word, sort = TRUE) |> 
  slice_max(n, n = 10) |> 
  filter(word)

graph16 <- top10words |> 
  ggplot(aes(x = reorder(word, n), y = n)) +
  geom_col(fill = "darkorange") +
  coord_flip() +
  labs(title = "Top 10 Frequent Words in Card Names", x = "Word", y = "Count") +
  theme_minimal()

# Graph 17
graph17 <- df2 |> 
  filter(!is.na(`Members`)) |> 
  separate_rows(`Members`, sep = ",\\s*") |> 
  count(`Members`, sort = TRUE) |> 
  ggplot(aes(x = reorder(`Members`, n), y = n, fill = `Members`)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(
    title = "Task Volume by Team Member",
    x = "Member",
    y = "Number of Tasks"
  ) +
  theme_minimal()

# Graph 18
graph18 <- df2 |> 
  filter(!is.na(`Effort`) & !is.na(Members)) |> 
  separate_rows(Members, sep = ",\\s*") |> 
  group_by(Members) |> 
  summarise(Total_Worked_Hours = sum(`Effort`, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(Members, Total_Worked_Hours), y = Total_Worked_Hours, fill = Members)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(
    title = "Worked Hours by Team Member",
    x = "Member",
    y = "Total Worked Hours"
  ) +
  theme_minimal()
```

```{r}
graph10
graph11
graph12
graph13
graph14
graph15
graph16
graph17
graph18
```
